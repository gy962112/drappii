<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Find Your Style | Drapii Luxe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap');

        :root {
            --accent: #9f2089;
            --accent-light: #fdf0f9;
            --accent-gradient: linear-gradient(135deg, #9f2089 0%, #ff5e9e 100%);
            --text-main: #2d0c28; /* Dark Begni Black */
            --text-muted: #8e6d8a;
            --bg-page: #fcf8fc; /* Soft Luxe Background */
            --card-radius: 24px;
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            font-family: 'Plus Jakarta Sans', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body { background: var(--bg-page); padding-bottom: 100px; color: var(--text-main); }

        /* --- LUXE SEARCH HEADER --- */
        .search-header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            padding: 18px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(159, 32, 137, 0.05);
        }

        .back-btn { font-size: 20px; color: var(--accent); cursor: pointer; }

        .search-input-wrapper {
            flex: 1;
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-input-wrapper i {
            position: absolute;
            left: 18px;
            color: var(--accent);
            font-size: 15px;
        }

        .search-bar {
            width: 100%;
            height: 52px;
            background: #fff;
            border: 1.5px solid #f0e6ef;
            border-radius: 18px;
            padding: 0 15px 0 48px;
            font-size: 15px;
            font-weight: 600;
            outline: none;
            transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-main);
        }
        .search-bar:focus {
            border-color: var(--accent);
            box-shadow: 0 10px 25px rgba(159, 32, 137, 0.08);
        }

        /* --- PREMIUM FILTERS --- */
        .filter-strip {
            padding: 15px 16px;
            display: flex;
            gap: 12px;
            overflow-x: auto;
            white-space: nowrap;
            scrollbar-width: none;
        }
        .filter-strip::-webkit-scrollbar { display: none; }

        .filter-chip {
            padding: 10px 22px;
            border: 1.5px solid #f0e6ef;
            border-radius: 15px;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-muted);
            background: #fff;
            cursor: pointer;
            transition: 0.3s;
        }
        .filter-chip.active {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
            box-shadow: 0 8px 20px rgba(159, 32, 137, 0.2);
        }

        /* --- RESULTS GRID --- */
        .results-container {
            padding: 10px 16px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 18px;
        }

        .product-card {
            background: #fff;
            border-radius: var(--card-radius);
            overflow: hidden;
            border: 1px solid rgba(159, 32, 137, 0.05);
            display: flex;
            flex-direction: column;
            box-shadow: 0 10px 20px rgba(159, 32, 137, 0.04);
            transition: 0.3s;
        }
        .product-card:active { transform: scale(0.96); }

        .p-img-wrapper { position: relative; width: 100%; aspect-ratio: 1/1.25; overflow: hidden; background: var(--accent-light); }
        .p-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }

        .p-info { padding: 15px; }
        .p-name {
            font-size: 14px; color: var(--text-main);
            font-weight: 700; height: 40px; overflow: hidden;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
            margin-bottom: 8px; line-height: 1.4;
        }
        .p-price { font-size: 18px; font-weight: 800; color: var(--accent); letter-spacing: -0.5px; }
        
        .p-delivery {
            font-size: 9px; color: #00b894; font-weight: 800;
            background: #ebfbee; padding: 4px 10px; border-radius: 8px;
            margin-top: 10px; display: inline-block; text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        /* --- EMPTY STATE --- */
        .empty-state {
            text-align: center; padding: 120px 40px; color: var(--text-muted);
        }
        .empty-state i { 
            font-size: 55px; margin-bottom: 25px; 
            background: var(--accent-light); color: var(--accent);
            width: 100px; height: 100px; line-height: 100px;
            border-radius: 40px; display: inline-block;
        }

        /* --- LUXE BOTTOM NAV --- */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; height: 85px;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            display: flex; justify-content: space-around;
            align-items: center; border-top: 1px solid rgba(159, 32, 137, 0.05);
            padding-bottom: 15px; z-index: 1000;
        }
        .nav-item { text-align: center; text-decoration: none; color: #bbb; font-size: 11px; font-weight: 700; transition: 0.3s; }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 6px; }
        .nav-item.active { color: var(--accent); }
    </style>
</head>
<body>

    <header class="search-header">
        <i class="fa-solid fa-chevron-left back-btn" onclick="location.href='index.html'"></i>
        <div class="search-input-wrapper">
            <i class="fa fa-search"></i>
            <input type="text" id="searchInput" class="search-bar" placeholder="Search elite collections..." autofocus>
        </div>
    </header>

    <div class="filter-strip" id="filterStrip">
        <div class="filter-chip active" data-cat="All">All Items</div>
        <div class="filter-chip" data-cat="Kurtis">Kurtis</div>
        <div class="filter-chip" data-cat="Sarees">Sarees</div>
        <div class="filter-chip" data-cat="Jewellery">Jewellery</div>
        <div class="filter-chip" data-cat="Men">Men</div>
        <div class="filter-chip" data-cat="Beauty">Beauty</div>
    </div>

    <div id="resultsGrid" class="results-container"></div>

    <div id="emptyState" class="empty-state" style="display: none;">
        <i class="fa-solid fa-magnifying-glass"></i>
        <h3 style="color:var(--text-main); margin-bottom:8px; font-weight: 800;">No Pieces Found</h3>
        <p style="font-size: 14px;">Try searching for different keywords or luxury categories.</p>
    </div>

    <nav class="bottom-nav">
        <a href="index.html" class="nav-item"><i class="fa-solid fa-house"></i>Home</a>
        <a href="search.html" class="nav-item active"><i class="fa-solid fa-magnifying-glass"></i>Search</a>
        <a href="orders.html" class="nav-item"><i class="fa-solid fa-bag-shopping"></i>Orders</a>
        <a href="profile.html" class="nav-item"><i class="fa-regular fa-user"></i>Account</a>
    </nav>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAktuzpc6myYe-szK-GbTQdn_Iu0bYQW8Q",
            authDomain: "fashora-flipkart.firebaseapp.com",
            projectId: "fashora-flipkart",
            storageBucket: "fashora-flipkart.firebasestorage.app",
            messagingSenderId: "383843603520",
            appId: "1:383843603520:web:729cb5ac9437eb7b1cbba5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let allProducts = [];
        let activeCategory = "All";

        onAuthStateChanged(auth, (user) => {
            if (!user) window.location.href = "login.html";
            else loadInitialProducts();
        });

        async function loadInitialProducts() {
            const snap = await getDocs(collection(db, "products"));
            allProducts = snap.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            const urlParams = new URLSearchParams(window.location.search);
            const catParam = urlParams.get('cat');
            if(catParam) {
                activeCategory = catParam;
                updateFilterUI(catParam);
            }
            
            renderProducts(allProducts);
        }

        function renderProducts(products) {
            const grid = document.getElementById('resultsGrid');
            const empty = document.getElementById('emptyState');
            
            let filtered = products;
            
            if (activeCategory !== "All") {
                filtered = filtered.filter(p => p.category === activeCategory);
            }

            const queryText = document.getElementById('searchInput').value.toLowerCase();
            if (queryText) {
                filtered = filtered.filter(p => 
                    p.name.toLowerCase().includes(queryText) || 
                    (p.category && p.category.toLowerCase().includes(queryText))
                );
            }

            grid.innerHTML = "";
            if (filtered.length === 0) {
                empty.style.display = "block";
                return;
            }

            empty.style.display = "none";
            filtered.forEach(p => {
                const price = Number(String(p.price).replace(/[^0-9.-]+/g,"")) || 0;
                grid.innerHTML += `
                    <div class="product-card" onclick="location.href='product.html?id=${p.id}'">
                        <div class="p-img-wrapper">
                            <img src="${p.image}" class="p-img" loading="lazy" onerror="this.src='https://via.placeholder.com/300x400?text=Luxe+Item'">
                        </div>
                        <div class="p-info">
                            <p class="p-name">${p.name}</p>
                            <p class="p-price">â‚¹${price.toLocaleString('en-IN')}</p>
                            <span class="p-delivery">Express Delivery</span>
                        </div>
                    </div>
                `;
            });
        }

        document.getElementById('searchInput').addEventListener('input', () => renderProducts(allProducts));

        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', (e) => {
                activeCategory = e.target.dataset.cat;
                updateFilterUI(activeCategory);
                renderProducts(allProducts);
            });
        });

        function updateFilterUI(cat) {
            document.querySelectorAll('.filter-chip').forEach(c => {
                c.classList.remove('active');
                if(c.dataset.cat === cat) c.classList.add('active');
            });
        }
    </script>
</body>
</html>
